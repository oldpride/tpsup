# for vs code
local usage prog BIN_DIRS NPM_DIRS DIR

prog=${FUNCNAME[1]}

usage="
usage:

   $prog check
   $prog set

"

if [ $# -ne 1 ]; then
   echo "$prog: wrong number of args"
   echo "$usage"
   return
fi

action=$1

# 

uname2term

if [ $UNAMETERM = cygwin ]; then
   FREECAD_HOME="C:/Program Files/FreeCAD 1.0" # PYTHONPATH needs windows style path
   FREECAD_HOME_TERM_SPECIFIC="/cygdrive/c/Program Files/FreeCAD 1.0"
   LIB_DIRS="$FREECAD_HOME/bin;$FREECAD_HOME/Ext" # for PYTHONPATH
elif [ $UNAMETERM = msys -o $UNAMETERM = vscode ]; then
   FREECAD_HOME="C:/Program Files/FreeCAD 1.0"
   FREECAD_HOME_TERM_SPECIFIC="/c/Program Files/FreeCAD 1.0"
   LIB_DIRS="$FREECAD_HOME/bin;$FREECAD_HOME/Ext" # for PYTHONPATH
else
   echo "$prog: unsupported UNAMETERM='$UNAMETERM'"
   return
fi

BIN_DIRS="$FREECAD_HOME_TERM_SPECIFIC/bin:$FREECAD_HOME_TERM_SPECIFIC/bin/Scripts"

#FreeCAD module is in bin folder

chk_freecad_executables () {
   for EXE in FreeCAD FreeCADCmd python
   do
      (set -x; which $EXE)
   done

}

if [ $action = check ]; then
   echo ""
   echo "current installations: "
   #split DIRS by :
   echo "$FREECAD_HOME_TERM_SPECIFIC" | tr ":" "\n" | while read DIR; do
      # $DIR may contain space, so we need to quote it
      ls -ld "$DIR"
   done

   chk_freecad_executables

elif [ $action = set ]; then
   echo "adding freecad bin folder to PATH: $BIN_DIRS"
   export PATH="$BIN_DIRS:$PATH"

   echo "adding freecad lib folder to PYTHONPATH: $LIB_DIRS"
   if [ "X$PYTHONPATH" = "X" ]; then
      export PYTHONPATH="$LIB_DIRS"
   else
      if [ $UNAMETERM = cygwin -o $UNAMETERM = msys -o $UNAMETERM = vscode ]; then
         export PYTHONPATH="$LIB_DIRS;$PYTHONPATH"
      else
         echo "$prog: unsupported UNAMETERM='$UNAMETERM'"
         return
      fi
   fi

   reduce PATH
   reduce PYTHONPATH

   # add freecad to PS1
   export PS1="(freecad) $PS1"
   
   chk_freecad_executables
else
   echo "$prog: unknown action=$action"
   echo "$usage"
   return
fi


myfreecadhome () {
   if [ "X$FREECAD_HOME" = "X" ]; then
      echo "FREECAD_HOME is not defined."
      return
   fi

   cd "$FREECAD_HOME"
}
